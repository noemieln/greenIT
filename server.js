const express=require("express"),sqlite3=require("sqlite3").verbose(),path=require("path"),app=express(),PORT=3e3;app.use((e,s,i)=>{console.log(`âž¡ï¸ ${e.method} ${e.url}`),i()}),app.use(express.json());const db=new sqlite3.Database("./database/disney.db",e=>{e?console.error("Erreur de connexion \xe0 la BDD",e):console.log("Connect\xe9 \xe0 la base de donn\xe9es SQLite")});db.serialize(()=>{db.run(`CREATE TABLE IF NOT EXISTS figurines (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    nom TEXT NOT NULL,
    description TEXT,
    image_url TEXT
)`)}),app.get("/api/figurines",(e,s)=>{db.all("SELECT * FROM figurines",[],(e,i)=>{e?s.status(400).json({error:e.message}):s.json(i)})}),app.post("/api/figurines",(e,s)=>{let{nom:i,description:r,image_url:a}=e.body;db.run("INSERT INTO figurines (nom, description, image_url) VALUES (?, ?, ?)",[i,r,a],function(e){e?s.status(400).json({error:e.message}):s.json({id:this.lastID})})}),app.delete("/api/figurines/:id",(e,s)=>{db.run("DELETE FROM figurines WHERE id = ?",[e.params.id],function(e){e?s.status(400).json({error:e.message}):s.json({message:"Figurine supprim\xe9e"})})}),app.post("/api/figurines/:id/update",(e,s)=>{console.log(`Requ\xeate UPDATE (POST) re\xe7ue pour l'ID : ${e.params.id}`);let{nom:i,description:r,image_url:a}=e.body,n=e.params.id;db.run("UPDATE figurines SET nom = ?, description = ?, image_url = ? WHERE id = ?",[i,r,a,n],function(e){e?s.status(400).json({error:e.message}):s.json({message:"Figurine modifi\xe9e avec succ\xe8s via POST"})})}),app.use(express.static(path.join(__dirname,"public"))),app.use((e,s)=>{s.status(404).json({error:"Route non trouv\xe9e",methode:e.method,chemin:e.url})}),app.listen(3e3,()=>{console.log(`ðŸ”¥ Serveur lanc\xe9 sur http://localhost:3000`)});